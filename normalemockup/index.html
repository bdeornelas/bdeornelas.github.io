---
layout: default
title: Mockup Revisione AI Referto | Dr. Benjamin De Ornelas
description: Flusso demo per la revisione AI di un referto cardiologico con output in due box: Italiano corretto e Segnalazioni errori.
og_title: Mockup Revisione AI Referto
og_description: Anteprima del flusso: input referto, analisi demo/API, due box di output.
og_image: /assets/img/og-card.jpg
twitter_title: Mockup Revisione AI Referto
twitter_description: Anteprima del flusso: input referto, analisi demo/API, due box di output.
twitter_image: /assets/img/og-card.jpg
---

<main class="py-12">
  <section class="text-center mb-10">
    <h1 class="text-4xl md:text-5xl font-extrabold tracking-tighter gradient-text">Mockup Revisione AI Referto</h1>
    <p class="max-w-3xl mx-auto text-slate-400 mt-3">Flusso finto per vedere l'esperienza: incolla o usa il referto di esempio, poi prova l'analisi in modalità Demo o API Reale. L'output viene separato in "Italiano corretto" e "Segnalazioni errori".</p>
  </section>

  <section class="max-w-4xl mx-auto space-y-6">
    <div class="glass-card rounded-xl p-6">
      <h2 class="text-2xl font-bold text-white mb-4">1) Input Referto</h2>
      <textarea id="nm-input-referto" class="w-full rounded-lg p-4 bg-slate-900/40 border border-slate-700 text-slate-200" rows="12" placeholder="Incolla qui il referto da analizzare..."></textarea>
      <div class="flex gap-3 mt-3">
        <button id="nm-load-sample" class="px-4 py-2 rounded-lg bg-sky-600 hover:bg-sky-500 text-white">Carica esempio</button>
        <button id="nm-clear" class="px-4 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-200">Svuota</button>
      </div>
    </div>

    <div class="glass-card rounded-xl p-6">
      <h2 class="text-2xl font-bold text-white mb-4">2) Analisi</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="rounded-lg p-4 bg-slate-900/40 border border-slate-700">
          <h3 class="font-semibold text-white mb-2">Modalità Demo</h3>
          <p class="text-sm text-slate-400 mb-3">Simula una risposta senza usare l'API. Utile per vedere il flusso.</p>
          <button id="nm-demo-btn" class="px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-500 text-white">Analizza (Demo)</button>
        </div>
        <div class="rounded-lg p-4 bg-slate-900/40 border border-slate-700">
          <h3 class="font-semibold text-white mb-2">API Reale (facoltativa)</h3>
          <label for="nm-api-key" class="text-sm text-slate-300">OpenAI API Key</label>
          <input type="password" id="nm-api-key" class="w-full mt-1 mb-2 px-3 py-2 rounded bg-slate-800 border border-slate-700 text-slate-200" placeholder="sk-...">
          <label class="text-sm text-slate-400 inline-flex items-center gap-2"><input type="checkbox" id="nm-save-key" class="rounded"> Ricorda chiave (solo su questo browser)</label>
          <div class="mt-3">
            <button id="nm-api-btn" class="px-4 py-2 rounded-lg bg-sky-600 hover:bg-sky-500 text-white">Analizza (API Reale)</button>
          </div>
        </div>
      </div>
      <div id="nm-status" class="mt-4 hidden"></div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="glass-card rounded-xl p-6">
        <h2 class="text-xl font-bold text-white mb-3">Italiano corretto</h2>
        <textarea id="nm-italiano" class="w-full rounded-lg p-4 bg-slate-900/40 border border-slate-700 text-slate-200 min-h-[220px]" placeholder="Il testo corretto comparirà qui..." readonly></textarea>
        <div class="text-right mt-2">
          <button id="nm-copy-italiano" class="px-3 py-2 rounded bg-slate-800 hover:bg-slate-700 text-slate-200">Copia</button>
        </div>
      </div>
      <div class="glass-card rounded-xl p-6">
        <h2 class="text-xl font-bold text-white mb-3">Segnalazioni errori</h2>
        <textarea id="nm-errori" class="w-full rounded-lg p-4 bg-slate-900/40 border border-slate-700 text-slate-200 min-h-[220px]" placeholder="Eventuali osservazioni cliniche compariranno qui..." readonly></textarea>
        <div class="text-right mt-2">
          <button id="nm-copy-errori" class="px-3 py-2 rounded bg-slate-800 hover:bg-slate-700 text-slate-200">Copia</button>
        </div>
      </div>
    </div>
  </section>

  <script>
    (function(){
      const $ = (sel) => document.querySelector(sel);
      const input = $('#nm-input-referto');
      const statusEl = $('#nm-status');
      const demoBtn = $('#nm-demo-btn');
      const apiBtn = $('#nm-api-btn');
      const apiKey = $('#nm-api-key');
      const saveKey = $('#nm-save-key');
      const outIt = $('#nm-italiano');
      const outErr = $('#nm-errori');

      function setStatus(msg, type='info'){
        statusEl.className = type === 'error' ? 'error-message' : 'info-message';
        statusEl.textContent = msg || '';
        statusEl.classList.toggle('hidden', !msg);
      }

      // Sample referto e risposta mock
      const sampleReferto = `ANAMNESI FAMILIARE\nPadre con IMA a 58 anni.\n\nANAMNESI PERSONALE\nIpertensione in terapia con ACE-inibitore. Fumatore occasionale.\n\nESAME OBIETTIVO\nPAO 145/88 mmHg, FC 76 bpm. BMI 27.\n\nECG\nRitmo sinusale, nessuna alterazione significativa.\n\nESAMI EMATOCHIMICI\nCol totale 210 mg/dL, HDL 42 mg/dL, LDL 140 mg/dL, TG 130 mg/dL.\n\nCONCLUSIONI\nIpertensione in compenso. Continuare terapia attuale. Nessun ulteriore accertamento al momento.`;

      const sampleItaliano = `ANAMNESI FAMILIARE\nPadre con pregresso infarto miocardico a 58 anni.\n\nANAMNESI PERSONALE\nIpertensione arteriosa in trattamento con ACE-inibitore. Fumo occasionale.\n\nESAME OBIETTIVO\nPAO 145/88 mmHg; FC 76 bpm; BMI 27 kg/m².\n\nECG\nRitmo sinusale; nessuna anomalia significativa.\n\nESAMI EMATOCHIMICI\nColesterolo totale 210 mg/dL; HDL 42 mg/dL; LDL 140 mg/dL; trigliceridi 130 mg/dL.\n\nCONCLUSIONI\nIpertensione in buon compenso clinico. Confermare la terapia in atto. Valutare modifiche dello stile di vita.`;

      const sampleErrori = `OSSERVAZIONI CLINICHE (AI)\n- PAO 145/88 mmHg: classificazione compatibile con ipertensione di Grado 1.\n- LDL 140 mg/dL: non a target per rischio cardiovascolare potenzialmente almeno moderato (ESC 2021–2024).\n- Considerare calcolo SCORE2 se età 40–69 anni; se rischio ≥ moderato, indicare target LDL \u003c 100 mg/dL (o più stringente se alto rischio).`;

      $('#nm-load-sample')?.addEventListener('click', ()=>{ input.value = sampleReferto; setStatus('Referto di esempio caricato.'); });
      $('#nm-clear')?.addEventListener('click', ()=>{ input.value=''; outIt.value=''; outErr.value=''; setStatus(''); });

      // Ricorda chiave opzionale
      try {
        const saved = localStorage.getItem('bdo_ai_api_key');
        if (saved) { apiKey.value = saved; saveKey.checked = true; }
      } catch (e) {}

      saveKey.addEventListener('change', ()=>{
        try {
          if (saveKey.checked && apiKey.value) localStorage.setItem('bdo_ai_api_key', apiKey.value);
          else localStorage.removeItem('bdo_ai_api_key');
        } catch(e) {}
      });

      apiKey.addEventListener('input', ()=>{
        if (saveKey.checked) {
          try { localStorage.setItem('bdo_ai_api_key', apiKey.value); } catch(e){}
        }
      });

      // Demo
      demoBtn.addEventListener('click', ()=>{
        const text = (input.value || '').trim();
        if (!text) { setStatus('Inserisci o carica un referto prima di procedere.', 'error'); return; }
        setStatus('Analisi demo in corso…');
        outIt.value = ''; outErr.value = '';
        demoBtn.disabled = true;
        setTimeout(()=>{
          outIt.value = sampleItaliano;
          outErr.value = sampleErrori.replace(/^OSSERVAZIONI CLINICHE \(AI\)/,'').trim();
          setStatus('Demo completata.');
          demoBtn.disabled = false;
        }, 900);
      });

      // API reale
      async function buildPrompt(referto){
        return `Sei un medico cardiologo esperto di linee guida ESC (European Society of Cardiology), abituato a redigere referti clinici sintetici e formalmente corretti.\n\n`+
               `Riceverai di seguito il testo completo di un referto cardiologico generato automaticamente da una pagina HTML.\n\n`+
               `Il tuo compito è duplice:\n\n`+
               `1. **Controllo linguistico e stilistico:**\n   - Migliora l’italiano clinico mantenendo il tono medico professionale, senza cambiare il significato.\n   - Elimina ripetizioni, frasi colloquiali o inutili.\n   - Mantieni la struttura e i titoli delle sezioni (es. “ANAMNESI FAMILIARE”, “ESAME OBIETTIVO”, ecc.).\n\n`+
               `2. **Controllo medico e aderenza alle linee guida ESC (2021–2024):**\n   - Verifica coerenza dei dati clinici (es. se la PAO e la classificazione di ipertensione sono coerenti).\n   - Controlla l’appropriatezza delle conclusioni e dei consigli terapeutici rispetto al rischio SCORE2, ai valori lipidici, e ai principi ESC.\n   - Evidenzia eventuali errori o raccomandazioni non aggiornate secondo ESC.\n   - Se rilevi discrepanze cliniche, falle notare in una sezione finale chiamata **“OSSERVAZIONI CLINICHE (AI)”** senza modificare direttamente i dati numerici.\n\n`+
               `Output richiesto:\n- Testo completo del referto corretto e ottimizzato, pronto per essere copiato nel gestionale.\n- Se presenti osservazioni o correzioni cliniche, aggiungi alla fine una sezione “OSSERVAZIONI CLINICHE (AI)” con punti elenco concisi.\n\n`+
               `Referto da analizzare:\n---\n${referto}\n---`;
      }

      apiBtn.addEventListener('click', async ()=>{
        const text = (input.value || '').trim();
        if (!text) { setStatus('Inserisci o carica un referto prima di procedere.', 'error'); return; }
        const key = (apiKey.value || '').trim();
        if (!key) { setStatus('Inserisci la tua OpenAI API key per usare l\'API reale, oppure usa la Demo.', 'error'); return; }

        setStatus('Chiamata API in corso…');
        apiBtn.disabled = true; outIt.value=''; outErr.value='';
        try {
          const prompt = await buildPrompt(text);
          const resp = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${key}`
            },
            body: JSON.stringify({
              model: 'gpt-4o-mini',
              temperature: 0.2,
              messages: [ { role: 'user', content: prompt } ]
            })
          });
          if (!resp.ok) {
            const t = await resp.text();
            throw new Error(`HTTP ${resp.status}: ${t}`);
          }
          const data = await resp.json();
          const content = data?.choices?.[0]?.message?.content || '';
          if (!content) throw new Error('Risposta vuota dall\'API');

          const re = /^\s*OSSERVAZIONI\s+CLINICHE\s*\(AI\)\s*:?/im;
          const m = content.match(re);
          if (m) {
            const idx = m.index || 0;
            outIt.value = content.slice(0, idx).trim();
            outErr.value = content.slice(idx).replace(re, '').trim();
          } else {
            outIt.value = content.trim();
            outErr.value = '(Nessuna osservazione trovata)';
          }
          setStatus('Analisi completata.');
        } catch (err) {
          console.error(err);
          setStatus('Errore durante la chiamata API: '+ err.message, 'error');
        } finally {
          apiBtn.disabled = false;
        }
      });

      // Copia rapida
      $('#nm-copy-italiano')?.addEventListener('click', ()=>{ if (outIt.value) navigator.clipboard.writeText(outIt.value); });
      $('#nm-copy-errori')?.addEventListener('click', ()=>{ if (outErr.value) navigator.clipboard.writeText(outErr.value); });

      // Autocarica esempio all'apertura per vedere subito il flusso
      if (!input.value) input.value = sampleReferto;
    })();
  </script>
</main>

