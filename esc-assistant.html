---
layout: null
permalink: /esc-assistant/
---
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESC Guidelines Assistant</title>
    <meta name="robots" content="noindex, nofollow">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh; color: #e4e4e7; line-height: 1.6;
        }
        .container { max-width: 900px; margin: 0 auto; padding: 20px; }
        header { text-align: center; padding: 40px 0; }
        header h1 { font-size: 2rem; color: #60a5fa; margin-bottom: 10px; }
        header p { color: #9ca3af; }
        .chat-box {
            background: rgba(30, 41, 59, 0.8); border-radius: 12px;
            padding: 20px; min-height: 400px; margin-bottom: 20px;
            max-height: 60vh; overflow-y: auto;
        }
        .message { margin-bottom: 16px; display: flex; gap: 12px; }
        .message.user { flex-direction: row-reverse; }
        .message .avatar {
            width: 36px; height: 36px; border-radius: 50%;
            background: #3b82f6; display: flex; align-items: center;
            justify-content: center; flex-shrink: 0;
        }
        .message.user .avatar { background: #10b981; }
        .message .content {
            max-width: 80%; padding: 12px 16px; border-radius: 12px;
            background: rgba(51, 65, 85, 0.8);
        }
        .message.user .content { background: rgba(59, 130, 246, 0.3); }
        .message h3 { color: #60a5fa; font-size: 1rem; margin-bottom: 8px; }
        .message strong { color: #fbbf24; }
        .input-area { display: flex; gap: 12px; }
        textarea {
            flex: 1; padding: 16px; border-radius: 12px; border: none;
            background: rgba(51, 65, 85, 0.8); color: white; resize: none;
            font-size: 1rem; min-height: 60px;
        }
        textarea:focus { outline: 2px solid #3b82f6; }
        button {
            padding: 16px 24px; border-radius: 12px; border: none;
            background: #3b82f6; color: white; font-weight: 600;
            cursor: pointer; transition: background 0.2s;
        }
        button:hover { background: #2563eb; }
        button:disabled { background: #475569; cursor: not-allowed; }
        .loading { display: flex; gap: 6px; padding: 8px 0; }
        .loading span {
            width: 8px; height: 8px; background: #60a5fa; border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out;
        }
        .loading span:nth-child(1) { animation-delay: -0.32s; }
        .loading span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        .examples { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }
        .example-btn {
            padding: 8px 16px; background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 20px;
            color: #93c5fd; cursor: pointer; font-size: 0.875rem;
        }
        .example-btn:hover { background: rgba(59, 130, 246, 0.3); }
        .api-input {
            display: flex; gap: 12px; margin-bottom: 20px; padding: 16px;
            background: rgba(251, 191, 36, 0.1); border-radius: 12px;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }
        .api-input input {
            flex: 1; padding: 12px; border-radius: 8px; border: none;
            background: rgba(51, 65, 85, 0.8); color: white;
        }
        .api-input button { padding: 12px 20px; }
        .status { font-size: 0.875rem; color: #fbbf24; margin-top: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ESC Guidelines Assistant</h1>
            <p>Interroga le Linee Guida ESC con citazioni automatiche</p>
        </header>

        <div class="api-input" id="api-section">
            <input type="password" id="api-key" placeholder="Inserisci OpenRouter API Key...">
            <button onclick="setApiKey()">Attiva</button>
        </div>
        <div class="status" id="status"></div>

        <div class="examples">
            <button class="example-btn" onclick="askQuestion('Criteri per stenosi aortica severa?')">Stenosi aortica severa</button>
            <button class="example-btn" onclick="askQuestion('Quando iniziare anticoagulante in FA?')">Anticoagulazione FA</button>
            <button class="example-btn" onclick="askQuestion('Soglia chirurgica aneurisma aorta ascendente?')">Aneurisma aorta</button>
            <button class="example-btn" onclick="askQuestion('Target pressorio in paziente diabetico?')">Target PA diabete</button>
        </div>

        <div class="chat-box" id="chat"></div>

        <div class="input-area">
            <textarea id="input" placeholder="Fai una domanda sulle linee guida ESC..." onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();send()}"></textarea>
            <button id="send-btn" onclick="send()">Invia</button>
        </div>
    </div>

    <script>
        let apiKey = localStorage.getItem('openrouter_key') || '';

        if (apiKey) {
            document.getElementById('api-section').style.display = 'none';
            document.getElementById('status').textContent = 'API Key salvata. Pronto!';
            document.getElementById('status').style.color = '#10b981';
        }

        function setApiKey() {
            apiKey = document.getElementById('api-key').value.trim();
            if (apiKey) {
                localStorage.setItem('openrouter_key', apiKey);
                document.getElementById('api-section').style.display = 'none';
                document.getElementById('status').textContent = 'API Key salvata. Pronto!';
                document.getElementById('status').style.color = '#10b981';
            }
        }

        function askQuestion(q) {
            document.getElementById('input').value = q;
            send();
        }

        function addMessage(content, isUser) {
            const chat = document.getElementById('chat');
            const msg = document.createElement('div');
            msg.className = 'message ' + (isUser ? 'user' : '');
            msg.innerHTML = `
                <div class="avatar">${isUser ? 'üë§' : '‚ù§Ô∏è'}</div>
                <div class="content">${formatContent(content)}</div>
            `;
            chat.appendChild(msg);
            chat.scrollTop = chat.scrollHeight;
            return msg;
        }

        function formatContent(text) {
            return text
                .replace(/^## (.*$)/gim, '<h3>$1</h3>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/\n/g, '<br>');
        }

        async function send() {
            const input = document.getElementById('input');
            const question = input.value.trim();
            if (!question || !apiKey) {
                if (!apiKey) alert('Inserisci prima la API Key OpenRouter');
                return;
            }

            input.value = '';
            document.getElementById('send-btn').disabled = true;

            addMessage(question, true);

            const loadingMsg = addMessage('<div class="loading"><span></span><span></span><span></span></div>', false);

            const systemPrompt = `Sei un esperto assistente per le Linee Guida ESC. Rispondi in italiano citando:
- Classe di Raccomandazione (I/IIa/IIb/III)
- Livello di Evidenza (A/B/C)
- PDF e sezione di riferimento
Usa questo formato:
## Raccomandazione ESC
**[Classe X, Livello Y]**: [Sintesi]
## Contesto Clinico
- Criteri/Soglie
- Imaging/Trattamento
- Follow-up
## Fonte
PDF, Sezione, Pagina`;

            try {
                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + apiKey,
                        'Content-Type': 'application/json',
                        'HTTP-Referer': window.location.href,
                        'X-Title': 'ESC Guidelines Assistant'
                    },
                    body: JSON.stringify({
                        model: 'anthropic/claude-3.5-sonnet',
                        messages: [
                            { role: 'system', content: systemPrompt },
                            { role: 'user', content: question }
                        ],
                        temperature: 0.3,
                        max_tokens: 2000
                    })
                });

                loadingMsg.remove();

                if (!response.ok) {
                    throw new Error('API Error: ' + response.status);
                }

                const data = await response.json();
                addMessage(data.choices[0].message.content, false);
            } catch (error) {
                loadingMsg.remove();
                addMessage('Errore: ' + error.message, false);
            }

            document.getElementById('send-btn').disabled = false;
        }
    </script>
</body>
</html>
